<UserControl
    x:Class="LogicSimulator.Views.SchemeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:anchorableViewModels="clr-namespace:LogicSimulator.ViewModels.AnchorableViewModels"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:behaviors="clr-namespace:LogicSimulator.Infrastructure.Behaviors"
    xmlns:converters="clr-namespace:LogicSimulator.Infrastructure.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dataPiping="clr-namespace:LogicSimulator.Infrastructure.DataPiping"
    xmlns:fa="http://schemas.fontawesome.io/icons/"
    xmlns:layers="clr-namespace:LogicSimulator.Scene.Layers;assembly=LogicSimulator.Scene"
    xmlns:local="clr-namespace:LogicSimulator.ViewModels.ObjectViewModels"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:renderers="clr-namespace:LogicSimulator.Scene.Layers.Renderers;assembly=LogicSimulator.Scene"
    xmlns:scene="clr-namespace:LogicSimulator.Scene;assembly=LogicSimulator.Scene"
    xmlns:selectors="clr-namespace:LogicSimulator.Infrastructure.Selectors"
    xmlns:tools="clr-namespace:LogicSimulator.Infrastructure.Tools"
    xmlns:views="clr-namespace:LogicSimulator.Scene.Views;assembly=LogicSimulator.Scene"
    d:DataContext="{d:DesignInstance Type=anchorableViewModels:SchemeViewModel}"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:RotationToFloatConverter x:Key="RotationToFloatConverter" />
    </UserControl.Resources>

    <Grid>
        <scene:Scene2D x:Name="Scene2D" Scale="{Binding Path=Scale, Mode=TwoWay}">
            <tools:ToolsController.Controller>
                <tools:ToolsController>
                    <tools:SelectionTool x:Name="SelectionTool" ObjectsLayer="{Binding ElementName=ObjectsLayer}" />
                    <tools:DragTool x:Name="DragTool" ObjectsLayer="{Binding ElementName=ObjectsLayer}" />
                </tools:ToolsController>
            </tools:ToolsController.Controller>

            <dataPiping:DataPiping.DataPipes>
                <dataPiping:DataPipe Source="{Binding ElementName=Scene2D, Path=MousePosition}" Target="{Binding Path=MousePosition, Mode=OneWayToSource}" />
                <dataPiping:DataPipe Source="{Binding ElementName=SelectionTool, Path=IsActive}" Target="{Binding Path=SelectionTool.IsActive, Mode=OneWayToSource}" />
                <dataPiping:DataPipe Source="{Binding ElementName=DragTool, Path=IsActive}" Target="{Binding Path=DragTool.IsActive, Mode=OneWayToSource}" />
            </dataPiping:DataPiping.DataPipes>

            <b:Interaction.Behaviors>
                <behaviors:SceneTransformBehaviour />
                <behaviors:SceneToolEventProviderBehaviour />
            </b:Interaction.Behaviors>

            <layers:GradientClearLayer EndColor="#E2E2E2" StartColor="#C1C1C1">
                <layers:GradientClearLayer.Renderer>
                    <renderers:GradientClearRenderer />
                </layers:GradientClearLayer.Renderer>
            </layers:GradientClearLayer>
            <layers:GridLayer
                Width="2970"
                Height="2100"
                Background="#FFFCF8"
                BoldLineColor="#DCDCD7"
                LineColor="#F0F0EB">
                <layers:GridLayer.Renderer>
                    <renderers:GridLayerRenderer />
                </layers:GridLayer.Renderer>
            </layers:GridLayer>
            <layers:ObjectsLayer x:Name="ObjectsLayer" Objects="{Binding Path=Objects}">
                <layers:ObjectsLayer.ObjectTemplateSelector>
                    <selectors:SceneObjectTemplateSelector>
                        <selectors:SceneObjectTemplateSelector.UnknownObjectDataTemplate>
                            <DataTemplate xmlns:baseVm="clr-namespace:LogicSimulator.ViewModels.ObjectViewModels.Base" DataType="{x:Type baseVm:BaseObjectViewModel}">
                                <views:UnknownObjectView Location="{Binding Path=Location}" Rotation="{Binding Path=Rotation, Converter={StaticResource RotationToFloatConverter}}" />
                            </DataTemplate>
                        </selectors:SceneObjectTemplateSelector.UnknownObjectDataTemplate>
                        <selectors:SceneObjectTemplateSelector.RectangleDataTemplate>
                            <DataTemplate DataType="{x:Type local:RectangleViewModel}">
                                <views:RectangleView
                                    Width="{Binding Path=Width}"
                                    Height="{Binding Path=Height}"
                                    FillColor="{Binding Path=FillColor}"
                                    IsFilled="{Binding Path=IsFilled}"
                                    IsSelected="{Binding Path=IsSelected}"
                                    Location="{Binding Path=Location}"
                                    Rotation="{Binding Path=Rotation,
                                                       Converter={StaticResource RotationToFloatConverter}}"
                                    StrokeColor="{Binding Path=StrokeColor}"
                                    StrokeThickness="{Binding Path=StrokeThickness}" />
                            </DataTemplate>
                        </selectors:SceneObjectTemplateSelector.RectangleDataTemplate>
                    </selectors:SceneObjectTemplateSelector>
                </layers:ObjectsLayer.ObjectTemplateSelector>
                <layers:ObjectsLayer.Renderer>
                    <renderers:ObjectsLayerRenderer />
                </layers:ObjectsLayer.Renderer>
            </layers:ObjectsLayer>
        </scene:Scene2D>
        <Border
            Margin="0,10,0,0"
            Padding="5"
            HorizontalAlignment="Center"
            VerticalAlignment="Top"
            Background="#353535"
            BorderBrush="#222222"
            BorderThickness="1"
            CornerRadius="3">
            <StackPanel Orientation="Horizontal">
                <ContentControl>
                    <ContentControl.Template>
                        <ControlTemplate>
                            <Border
                                Width="25"
                                Height="25"
                                Margin="0,0,5,0"
                                Padding="3"
                                Background="#424242"
                                BorderBrush="#222222"
                                BorderThickness="1"
                                CornerRadius="3">
                                <fa:ImageAwesome
                                    x:Name="Icon"
                                    Foreground="#6283A2"
                                    Icon="MousePointer" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectionTool.IsActive}" Value="True">
                                    <Setter TargetName="Icon" Property="Foreground" Value="White" />
                                </DataTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </ContentControl.Template>
                </ContentControl>
                <ContentControl>
                    <ContentControl.Template>
                        <ControlTemplate>
                            <Border
                                Width="25"
                                Height="25"
                                Padding="3"
                                Background="#424242"
                                BorderBrush="#222222"
                                BorderThickness="1"
                                CornerRadius="3">
                                <fa:ImageAwesome
                                    x:Name="Icon"
                                    Foreground="#6283A2"
                                    Icon="HandGrabOutline" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <DataTrigger Binding="{Binding Path=DragTool.IsActive}" Value="True">
                                    <Setter TargetName="Icon" Property="Foreground" Value="White" />
                                </DataTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </ContentControl.Template>
                </ContentControl>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
