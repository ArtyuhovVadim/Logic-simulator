<c:Window
    x:Class="LogicSimulator.Views.Windows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avm="clr-namespace:LogicSimulator.ViewModels.AnchorableViewModels"
    xmlns:c="clr-namespace:LogicSimulator.Controls;assembly=LogicSimulator.Controls"
    xmlns:commands="clr-namespace:LogicSimulator.Infrastructure.Commands"
    xmlns:con="clr-namespace:LogicSimulator.Infrastructure.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fa="http://schemas.fontawesome.io/icons/"
    xmlns:infrastructure="clr-namespace:LogicSimulator.Infrastructure"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="clr-namespace:LogicSimulator.ViewModels"
    xmlns:views="clr-namespace:LogicSimulator.Views"
    Title="Logic-simulator"
    Width="1280"
    Height="720"
    DataContext="{Binding Path=MainWindowViewModel,
                          Source={StaticResource Locator}}"
    Icon="/Icons/icon512x512.png"
    mc:Ignorable="d">

    <c:Window.Resources>
        <con:Vector2Converter x:Key="Vector2Converter" />
        <commands:AppExitCommand x:Key="AppExitCommand" />
    </c:Window.Resources>

    <DockPanel>
        <Grid DockPanel.Dock="Top">
            <Menu IsMainMenu="True">
                <MenuItem Header="Файл">
                    <MenuItem Command="{Binding Path=TestCommand}" Header="Test" />
                    <Separator />
                    <MenuItem Header="Новый" />
                    <MenuItem Command="{Binding Path=LoadExampleCommand}" Header="Загрузить пример" />
                    <MenuItem Command="{Binding Path=SaveExampleCommand}" Header="Сохранить пример" />
                    <Separator />
                    <MenuItem Command="{StaticResource AppExitCommand}" Header="Выход" />
                </MenuItem>
            </Menu>

            <Button
                Height="21"
                Margin="2,0,2,0"
                Padding="5"
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                Background="Transparent"
                BorderThickness="0">
                <fa:ImageAwesome
                    Foreground="White"
                    Icon="Cog"
                    SnapsToDevicePixels="True"
                    UseLayoutRounding="True" />
            </Button>
        </Grid>

        <Grid DockPanel.Dock="Bottom">
            <StatusBar Background="#424242">
                <TextBlock
                    Margin="0,0,5,0"
                    Foreground="White"
                    Text="{Binding Path=ActiveContent.Scale,
                                   StringFormat='Масштаб: {0:0.00}',
                                   FallbackValue=''}" />
                <TextBlock
                    Margin="0,0,5,0"
                    Foreground="White"
                    Text="{Binding Path=ActiveContent.MousePosition,
                                   StringFormat='Позиция курсора: {0}',
                                   Converter={StaticResource Vector2Converter},
                                   FallbackValue=''}" />
                <TextBlock
                    Margin="0,0,5,0"
                    Foreground="White"
                    Text="{Binding Path=ActiveContent.Objects.Count,
                                   StringFormat='Кол-во объектов: {0}',
                                   FallbackValue=''}" />
            </StatusBar>

            <Menu HorizontalAlignment="Right">
                <MenuItem Header="Панели" ItemsSource="{Binding Path=AnchorableViewModels}">
                    <MenuItem.ItemContainerStyle>
                        <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
                            <Setter Property="IsCheckable" Value="True" />
                            <Setter Property="Header" Value="{Binding Path=Name}" />
                            <Setter Property="IsChecked" Value="{Binding Path=IsVisible}" />
                        </Style>
                    </MenuItem.ItemContainerStyle>
                </MenuItem>
            </Menu>
        </Grid>

        <DockingManager
            ActiveContent="{Binding Path=ActiveContent,
                                    Mode=TwoWay}"
            AnchorablesSource="{Binding Path=AnchorableViewModels}"
            DocumentsSource="{Binding Path=SchemeViewModels}">
            <DockingManager.LayoutItemTemplateSelector>
                <infrastructure:PanesTemplateSelector>
                    <infrastructure:PanesTemplateSelector.SchemeViewTemplate>
                        <DataTemplate DataType="{x:Type viewModels:SchemeViewModel}">
                            <views:SchemeView />
                        </DataTemplate>
                    </infrastructure:PanesTemplateSelector.SchemeViewTemplate>
                    <infrastructure:PanesTemplateSelector.PropertiesViewTemplate>
                        <DataTemplate DataType="{x:Type avm:PropertiesViewModel}">
                            <views:PropertiesView />
                        </DataTemplate>
                    </infrastructure:PanesTemplateSelector.PropertiesViewTemplate>
                    <infrastructure:PanesTemplateSelector.ProjectExplorerViewTemplate>
                        <DataTemplate DataType="{x:Type avm:ProjectExplorerViewModel}">
                            <TextBlock FontSize="24" Text="{Binding Path=Name}" />
                        </DataTemplate>
                    </infrastructure:PanesTemplateSelector.ProjectExplorerViewTemplate>
                </infrastructure:PanesTemplateSelector>
            </DockingManager.LayoutItemTemplateSelector>
            <DockingManager.LayoutItemContainerStyleSelector>
                <infrastructure:PanesStyleSelector>
                    <infrastructure:PanesStyleSelector.SchemeViewStyle>
                        <Style TargetType="{x:Type LayoutDocumentItem}">
                            <Setter Property="Title" Value="{Binding Path=Model.Name}" />
                            <Setter Property="CanClose" Value="False" />
                        </Style>
                    </infrastructure:PanesStyleSelector.SchemeViewStyle>
                    <infrastructure:PanesStyleSelector.PropertiesViewStyle>
                        <Style TargetType="{x:Type LayoutAnchorableItem}">
                            <Setter Property="Title" Value="{Binding Path=Model.Name}" />
                            <Setter Property="Visibility" Value="{Binding Path=Model.IsVisible, Mode=TwoWay, ConverterParameter={x:Static Visibility.Hidden}, Converter={BoolToVisibilityConverter}}" />
                        </Style>
                    </infrastructure:PanesStyleSelector.PropertiesViewStyle>
                    <infrastructure:PanesStyleSelector.ProjectExplorerViewStyle>
                        <Style TargetType="{x:Type LayoutAnchorableItem}">
                            <Setter Property="Title" Value="{Binding Path=Model.Name}" />
                            <Setter Property="Visibility" Value="{Binding Path=Model.IsVisible, Mode=TwoWay, ConverterParameter={x:Static Visibility.Hidden}, Converter={BoolToVisibilityConverter}}" />
                        </Style>
                    </infrastructure:PanesStyleSelector.ProjectExplorerViewStyle>
                </infrastructure:PanesStyleSelector>
            </DockingManager.LayoutItemContainerStyleSelector>

            <LayoutRoot>
                <LayoutPanel>
                    <LayoutDocumentPane />
                </LayoutPanel>
            </LayoutRoot>
        </DockingManager>
    </DockPanel>
</c:Window>
